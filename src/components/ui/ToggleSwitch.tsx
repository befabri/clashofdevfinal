import clsx from "clsx";
import { useEffect, useState } from "preact/hooks";

const Theme = {
    LIGHT: "light",
    DARK: "dark",
    UNSET: "",
};

export default function ToggleTheme() {
    const [theme, setTheme] = useState(Theme.UNSET);
    const [isLoaded, setLoaded] = useState(false);

    useEffect(() => {
        const htmlElement = document.querySelector("html");
        const storedTheme = htmlElement?.dataset.theme || Theme.LIGHT;
        setTheme(storedTheme);
        setTimeout(() => setLoaded(true), 100);
    }, []);

    const toggleTheme = () => {
        const newTheme = theme === "dark" ? "light" : "dark";
        localStorage.setItem("color-scheme", newTheme);
        document.documentElement.setAttribute("data-theme", newTheme);
        setTheme(newTheme);
    };

    if (theme === Theme.UNSET) {
        return (
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" class="sr-only peer" checked={true} />
                <div class="w-[54px] h-[27px] bg-cod_white rounded-full peer-checked:bg-cod_black p-2 transition-none"></div>
                <div class="absolute inset-y-0 left-1.5 w-[23px] h-[23px] bg-beige dark:bg-cod_black/95 rounded-full transform peer-checked:translate-x-[19px] flex items-center justify-center m-auto transition-none">
                    <svg viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="h-4 w-3.5">
                        <path
                            d="M11.1738 14.6812C10.6563 14.8187 10.1668 14.899 9.67772 14.9252C8.84205 14.9729 8.03728 14.8713 7.28959 14.6278C6.02103 14.2133 4.95659 13.4311 4.12494 12.2984C3.60564 11.5914 3.21321 10.7862 2.95975 9.90679C2.70677 9.0293 2.62092 8.1406 2.7072 7.26843C2.79646 6.36018 3.06764 5.49907 3.51102 4.71055C3.98103 3.8755 4.61884 3.15157 5.40986 2.55301C6.0971 2.03188 6.86422 1.61825 7.69135 1.32156C7.9063 1.24366 8.12371 1.17548 8.34169 1.11753C8.7587 1.00668 9.1846 0.930845 9.608 0.893043L9.6792 0.886575C10.0072 0.855452 10.3456 0.8257 10.7471 0.87679C10.7471 0.87679 10.7803 0.8804 11.316 0.958101C11.3308 0.960409 11.3432 0.969561 11.3523 0.981666C11.7368 1.65186 12.0865 2.35209 12.392 3.06196C12.7622 3.92284 13.0785 4.81879 13.3303 5.72359C13.3367 5.74888 13.3251 5.77481 13.3009 5.7833C13.3009 5.7833 13.0762 5.87835 13.0724 5.87936C13.061 5.88238 13.0468 5.88202 13.0377 5.8782C12.5749 5.67314 12.0938 5.53112 11.6076 5.45689C11.3273 5.41303 10.8601 5.34204 10.2661 5.42519C10.1058 5.44706 9.94598 5.47915 9.78865 5.52098C9.71663 5.54012 9.64649 5.55877 9.57405 5.58425C9.12365 5.73097 8.73429 5.90299 8.38374 6.1083C7.83808 6.42984 7.46891 6.77714 7.22546 7.20521C6.95347 7.68033 6.88459 8.18243 7.01775 8.69934C7.10601 9.03924 7.24316 9.32462 7.43652 9.57637C7.71405 9.93656 8.07733 10.1722 8.51541 10.28C8.97731 10.3939 9.45558 10.381 9.97685 10.2424C10.0565 10.2213 10.1337 10.1987 10.2118 10.1717C10.7493 9.99347 11.2401 9.75087 11.6701 9.45179C11.8424 9.33332 12.0064 9.19835 12.1594 9.05178C12.5191 8.70701 12.7241 8.3743 12.9215 8.05189C13.1362 7.70204 13.327 7.32949 13.4858 6.9426C13.4909 6.93086 13.5008 6.922 13.5117 6.91704L13.7317 6.81911C13.7525 6.81357 13.7754 6.82409 13.7865 6.84397C14.1453 7.50854 14.4759 8.19724 14.7718 8.89306C15.1343 9.74767 15.4524 10.6348 15.7155 11.5283C15.7185 11.54 15.719 11.5502 15.7139 11.562C15.7065 11.5806 15.6968 11.606 15.6842 11.6363C15.4291 12.2419 14.9726 12.5958 14.443 13.0044C14.3685 13.0616 14.2926 13.1212 14.2166 13.1809C13.515 13.7328 12.7205 14.1662 11.8582 14.4681C11.6276 14.5481 11.3989 14.6193 11.1771 14.6782L11.1738 14.6812Z"
                            class="fill-current text-cod_black dark:text-white"
                        />
                        <path
                            d="M8.35073 1.16912C8.76395 1.05927 9.18416 0.984947 9.60756 0.947145C9.95358 0.915378 10.3119 0.876193 10.7367 0.931466C10.7367 0.931466 10.7699 0.935075 11.3051 1.01083C11.6529 1.61604 12.0067 2.30892 12.3414 3.08579C12.7543 4.04329 13.0545 4.93938 13.2777 5.73964C13.203 5.77197 13.1277 5.80236 13.053 5.83469C12.4805 5.5799 11.9758 5.46489 11.61 5.41057C11.2965 5.3631 10.8402 5.29543 10.2543 5.37851C10.092 5.40088 9.93224 5.43297 9.77112 5.4758C9.69909 5.49495 9.62517 5.5146 9.55462 5.53958C9.13595 5.67579 8.73374 5.845 8.35343 6.0686C7.88006 6.34808 7.45766 6.69292 7.17726 7.18273C6.90387 7.66029 6.8237 8.1737 6.96517 8.7154C7.05047 9.04363 7.18777 9.34557 7.39266 9.61087C7.67933 9.98316 8.04978 10.2231 8.49833 10.3323C9.00118 10.4561 9.49684 10.424 9.98399 10.2945C10.0636 10.2733 10.1427 10.2502 10.2227 10.2227C10.7456 10.0505 11.2379 9.81376 11.6938 9.49739C11.8708 9.37352 12.0348 9.23855 12.1878 9.09199C12.5456 8.74771 12.7455 8.42675 12.9574 8.0818C13.1268 7.80837 13.3313 7.43424 13.5259 6.96516C13.5969 6.93384 13.6679 6.90252 13.7388 6.8712C14.07 7.48288 14.4029 8.16474 14.7231 8.91639C15.1205 9.85306 15.4263 10.7394 15.6653 11.5458C15.6593 11.562 15.6496 11.5874 15.6351 11.6182C15.3499 12.2962 14.8045 12.6509 14.1825 13.1422C13.471 13.703 12.6878 14.1251 11.8383 14.4215C11.6134 14.4999 11.3884 14.5701 11.1609 14.6306C10.6738 14.7601 10.1796 14.8458 9.67297 14.8746C8.86721 14.9206 8.07347 14.8305 7.30147 14.5789C6.011 14.1579 4.97219 13.373 4.16171 12.2679C3.63566 11.5502 3.25377 10.7547 3.00475 9.89275C2.7572 9.03665 2.66532 8.16409 2.75334 7.27485C2.84169 6.37099 3.10826 5.52358 3.55023 4.7375C4.02816 3.88581 4.66423 3.17895 5.43497 2.59617C6.1312 2.07058 6.88793 1.66386 7.70229 1.37263C7.91534 1.29524 8.13134 1.22951 8.34933 1.17157M8.32465 1.07431C8.10667 1.13225 7.88736 1.20093 7.67053 1.27934C6.8396 1.57704 6.06918 1.99363 5.37675 2.51821C4.58054 3.12022 3.93802 3.84956 3.46521 4.68951C3.01763 5.48538 2.74554 6.35087 2.65636 7.26741C2.56917 8.14397 2.65601 9.03656 2.91096 9.92184C3.1659 10.8071 3.56122 11.6156 4.08389 12.328C4.9218 13.4694 5.9939 14.2579 7.27341 14.6757C8.02778 14.9215 8.83873 15.0237 9.68058 14.9764C10.1734 14.9492 10.6667 14.8679 11.188 14.7293C11.4098 14.6703 11.6405 14.5986 11.873 14.5182C12.7409 14.2148 13.5392 13.7804 14.2455 13.223C14.3234 13.1629 14.3974 13.1038 14.4719 13.0466C15.0062 12.6325 15.4684 12.2771 15.7281 11.6579C15.7407 11.6275 15.7518 11.5997 15.7578 11.5835C15.7667 11.5625 15.7669 11.5396 15.7615 11.5182C15.4979 10.6227 15.1798 9.73558 14.8163 8.87708C14.5199 8.17931 14.1889 7.48867 13.8282 6.82461C13.8059 6.78483 13.7601 6.76379 13.7184 6.77487C13.7127 6.77639 13.7089 6.77739 13.7033 6.7789L13.4904 6.87287C13.4667 6.88331 13.4493 6.90247 13.4391 6.92595C13.2817 7.31039 13.0923 7.68049 12.879 8.02789C12.6745 8.36255 12.4794 8.67811 12.1244 9.01748C11.9747 9.1611 11.8126 9.29556 11.6422 9.41353C11.216 9.71161 10.7285 9.95125 10.1962 10.126C10.1175 10.151 10.0389 10.1761 9.9631 10.1962C9.44942 10.3328 8.97923 10.3457 8.52351 10.2322C8.09639 10.1277 7.74216 9.89586 7.47139 9.54634C7.2819 9.30187 7.14763 9.01987 7.06135 8.68775C6.92974 8.18496 6.99779 7.69554 7.26228 7.23072C7.50202 6.81194 7.8641 6.4686 8.40316 6.15297C8.75182 5.94816 9.13788 5.7791 9.58449 5.63338C9.65553 5.61035 9.72517 5.58976 9.7953 5.57112C9.95074 5.5298 10.1105 5.4977 10.2666 5.4749C10.8506 5.39232 11.3159 5.46381 11.5938 5.50623C12.0781 5.58097 12.5545 5.72011 13.0111 5.92473C13.0316 5.93381 13.0544 5.93605 13.0753 5.9305C13.0791 5.9295 13.0847 5.92799 13.0885 5.92698L13.3133 5.83193C13.3592 5.8135 13.3844 5.76113 13.3696 5.71106C13.1173 4.80432 12.8005 3.90642 12.4299 3.0436C12.1238 2.33178 11.7718 1.63011 11.3868 0.957972C11.3718 0.93081 11.345 0.913011 11.3155 0.908394C10.7847 0.833575 10.7466 0.827083 10.7466 0.827083C10.3409 0.775056 9.99863 0.805815 9.66826 0.835497L9.59517 0.842469C9.16987 0.880775 8.74208 0.957117 8.32128 1.06898L8.32465 1.07431Z"
                            class="fill-current text-cod_black dark:text-white"
                        />
                        <path
                            d="M3.80423 2.43558L0.499442 2.43097C0.479575 2.43095 0.461865 2.4447 0.456058 2.46415C-0.388879 5.29389 -0.203226 6.7304 2.2437 8.75751C2.25394 8.76599 2.26799 8.76965 2.28094 8.76719C5.19421 8.21409 6.04206 7.04442 6.77992 4.15724C6.78514 4.13682 6.77629 4.11486 6.75825 4.10463L3.82607 2.44138C3.81939 2.43759 3.81187 2.43559 3.80423 2.43558Z"
                            class="fill-current text-pink_mid dark:text-pink_dark"
                        />
                        <path
                            d="M4.74044 4.03733L3.12466 3.75481L1.98723 5.51975L2.80624 5.66296L1.96798 7.14356L4.25072 5.32638L3.22418 5.14689L4.74044 4.03733Z"
                            class="fill-current text-cod_black dark:text-white"
                        />
                    </svg>
                </div>
            </label>
        );
    }

    return (
        <label
            class="relative inline-flex items-center cursor-pointer"
            aria-label="Basculer entre le mode sombre et le mode clair">
            <input
                type="checkbox"
                class="sr-only peer"
                checked={theme === Theme.DARK}
                onChange={toggleTheme}
                aria-checked={theme === Theme.DARK}
                role="switch"
            />

            <div
                class={clsx(
                    "w-[54px] h-[27px] bg-cod_white rounded-full peer-checked:bg-cod_black p-2",
                    isLoaded ? "transition-colors duration-200 ease-in-out" : "transition-none"
                )}></div>
            <div
                class={clsx(
                    "absolute inset-y-0 left-1.5 w-[23px] h-[23px] bg-cod_black dark:bg-cod_black/95 rounded-full transform peer-checked:translate-x-[19px] flex items-center justify-center m-auto",
                    isLoaded ? "transition-transform duration-200 ease-in-out" : "transition-none"
                )}>
                <svg
                    viewBox="0 0 16 15"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-3.5"
                    role="img"
                    aria-label="Icône de mode sombre/clair">
                    <path
                        d="M11.1738 14.6793C10.6563 14.8168 10.1668 14.8971 9.67772 14.9233C8.84205 14.971 8.03728 14.8694 7.28959 14.6259C6.02103 14.2114 4.95659 13.4292 4.12494 12.2965C3.60564 11.5895 3.21321 10.7843 2.95975 9.9049C2.70677 9.0274 2.62092 8.13871 2.7072 7.26654C2.79646 6.35828 3.06764 5.49718 3.51102 4.70866C3.98103 3.87361 4.61884 3.14967 5.40986 2.55112C6.0971 2.02999 6.86422 1.61636 7.69135 1.31966C7.9063 1.24176 8.12371 1.17359 8.34169 1.11564C8.7587 1.00479 9.1846 0.928953 9.608 0.891151L9.6792 0.884683C10.0072 0.85356 10.3456 0.823808 10.7471 0.874898C10.7471 0.874898 10.7803 0.878507 11.316 0.956209C11.3308 0.958517 11.3432 0.967669 11.3523 0.979774C11.7368 1.64997 12.0865 2.3502 12.392 3.06007C12.7622 3.92095 13.0785 4.8169 13.3303 5.7217C13.3367 5.74698 13.3251 5.77292 13.3009 5.78141C13.3009 5.78141 13.0762 5.87646 13.0724 5.87746C13.061 5.88049 13.0468 5.88012 13.0377 5.8763C12.5749 5.67125 12.0938 5.52923 11.6076 5.455C11.3273 5.41114 10.8601 5.34015 10.2661 5.4233C10.1058 5.44517 9.94598 5.47726 9.78865 5.51908C9.71663 5.53823 9.64649 5.55687 9.57405 5.58236C9.12365 5.72908 8.73429 5.9011 8.38374 6.10641C7.83808 6.42795 7.46891 6.77524 7.22546 7.20332C6.95347 7.67844 6.88459 8.18054 7.01775 8.69745C7.10601 9.03735 7.24316 9.32273 7.43652 9.57448C7.71405 9.93466 8.07733 10.1703 8.51541 10.2781C8.97731 10.392 9.45558 10.3791 9.97685 10.2405C10.0565 10.2194 10.1337 10.1968 10.2118 10.1698C10.7493 9.99158 11.2401 9.74898 11.6701 9.44989C11.8424 9.33143 12.0064 9.19646 12.1594 9.04989C12.5191 8.70511 12.7241 8.37241 12.9215 8.05C13.1362 7.70015 13.327 7.3276 13.4858 6.94071C13.4909 6.92897 13.5008 6.92011 13.5117 6.91514L13.7317 6.81722C13.7525 6.81168 13.7754 6.8222 13.7865 6.84208C14.1453 7.50665 14.4759 8.19535 14.7718 8.89117C15.1343 9.74578 15.4524 10.6329 15.7155 11.5264C15.7185 11.5381 15.719 11.5483 15.7139 11.5601C15.7065 11.5787 15.6968 11.6041 15.6842 11.6344C15.4291 12.24 14.9726 12.5939 14.443 13.0025C14.3685 13.0597 14.2926 13.1194 14.2166 13.179C13.515 13.731 12.7205 14.1643 11.8582 14.4662C11.6276 14.5462 11.3989 14.6174 11.1771 14.6763L11.1738 14.6793Z"
                        fill="#F3F3F1"
                    />
                    <path
                        d="M8.35073 1.16723C8.76395 1.05738 9.18416 0.983055 9.60756 0.945253C9.95358 0.913486 10.3119 0.874301 10.7367 0.929574C10.7367 0.929574 10.7699 0.933183 11.3051 1.00894C11.6529 1.61415 12.0067 2.30703 12.3414 3.0839C12.7543 4.0414 13.0545 4.93749 13.2777 5.73775C13.203 5.77008 13.1277 5.80047 13.053 5.83279C12.4805 5.57801 11.9758 5.463 11.61 5.40868C11.2965 5.36121 10.8402 5.29354 10.2543 5.37662C10.092 5.39899 9.93224 5.43108 9.77112 5.47391C9.69909 5.49306 9.62517 5.51271 9.55462 5.53769C9.13595 5.6739 8.73374 5.84311 8.35343 6.06671C7.88006 6.34619 7.45766 6.69103 7.17726 7.18084C6.90387 7.6584 6.8237 8.17181 6.96517 8.7135C7.05047 9.04173 7.18777 9.34368 7.39266 9.60898C7.67933 9.98127 8.04978 10.2212 8.49833 10.3304C9.00118 10.4542 9.49684 10.4221 9.98399 10.2926C10.0636 10.2714 10.1427 10.2483 10.2227 10.2208C10.7456 10.0486 11.2379 9.81187 11.6938 9.4955C11.8708 9.37163 12.0348 9.23666 12.1878 9.09009C12.5456 8.74582 12.7455 8.42486 12.9574 8.0799C13.1268 7.80648 13.3313 7.43235 13.5259 6.96327C13.5969 6.93195 13.6679 6.90063 13.7388 6.8693C14.07 7.48099 14.4029 8.16284 14.7231 8.9145C15.1205 9.85117 15.4263 10.7375 15.6653 11.5439C15.6593 11.5601 15.6496 11.5855 15.6351 11.6163C15.3499 12.2943 14.8045 12.649 14.1825 13.1403C13.471 13.7011 12.6878 14.1232 11.8383 14.4196C11.6134 14.4981 11.3884 14.5682 11.1609 14.6287C10.6738 14.7582 10.1796 14.8439 9.67297 14.8727C8.86721 14.9187 8.07347 14.8286 7.30147 14.577C6.011 14.156 4.97219 13.3711 4.16171 12.266C3.63566 11.5483 3.25377 10.7528 3.00475 9.89086C2.7572 9.03476 2.66532 8.1622 2.75334 7.27296C2.84169 6.3691 3.10826 5.52168 3.55023 4.73561C4.02816 3.88392 4.66423 3.17706 5.43497 2.59428C6.1312 2.06868 6.88793 1.66197 7.70229 1.37074C7.91534 1.29335 8.13134 1.22762 8.34933 1.16967M8.32465 1.07242C8.10667 1.13036 7.88736 1.19904 7.67053 1.27744C6.8396 1.57515 6.06918 1.99173 5.37675 2.51632C4.58054 3.11833 3.93802 3.84766 3.46521 4.68762C3.01763 5.48348 2.74554 6.34898 2.65636 7.26552C2.56917 8.14208 2.65601 9.03467 2.91096 9.91995C3.1659 10.8052 3.56122 11.6137 4.08389 12.3261C4.9218 13.4675 5.9939 14.256 7.27341 14.6738C8.02778 14.9197 8.83873 15.0218 9.68058 14.9745C10.1734 14.9473 10.6667 14.866 11.188 14.7274C11.4098 14.6685 11.6405 14.5968 11.873 14.5163C12.7409 14.2129 13.5392 13.7785 14.2455 13.2211C14.3234 13.161 14.3974 13.1019 14.4719 13.0447C15.0062 12.6306 15.4684 12.2752 15.7281 11.656C15.7407 11.6256 15.7518 11.5978 15.7578 11.5816C15.7667 11.5606 15.7669 11.5377 15.7615 11.5163C15.4979 10.6209 15.1798 9.73369 14.8163 8.87519C14.5199 8.17742 14.1889 7.48678 13.8282 6.82271C13.8059 6.78294 13.7601 6.7619 13.7184 6.77298C13.7127 6.77449 13.7089 6.7755 13.7033 6.77701L13.4904 6.87098C13.4667 6.88142 13.4493 6.90058 13.4391 6.92406C13.2817 7.3085 13.0923 7.6786 12.879 8.026C12.6745 8.36065 12.4794 8.67622 12.1244 9.01559C11.9747 9.15921 11.8126 9.29367 11.6422 9.41163C11.216 9.70971 10.7285 9.94936 10.1962 10.1241C10.1175 10.1491 10.0389 10.1742 9.9631 10.1943C9.44942 10.3309 8.97923 10.3438 8.52351 10.2303C8.09639 10.1258 7.74216 9.89397 7.47139 9.54444C7.2819 9.29997 7.14763 9.01798 7.06135 8.68586C6.92974 8.18307 6.99779 7.69365 7.26228 7.22883C7.50202 6.81005 7.8641 6.46671 8.40316 6.15108C8.75182 5.94627 9.13788 5.7772 9.58449 5.63149C9.65553 5.60846 9.72517 5.58787 9.7953 5.56922C9.95074 5.52791 10.1105 5.49581 10.2666 5.47301C10.8506 5.39043 11.3159 5.46192 11.5938 5.50434C12.0781 5.57908 12.5545 5.71822 13.0111 5.92284C13.0316 5.93192 13.0544 5.93416 13.0753 5.92861C13.0791 5.92761 13.0847 5.92609 13.0885 5.92509L13.3133 5.83004C13.3592 5.81161 13.3844 5.75924 13.3696 5.70917C13.1173 4.80243 12.8005 3.90453 12.4299 3.04171C12.1238 2.32989 11.7718 1.62822 11.3868 0.95608C11.3718 0.928918 11.345 0.911119 11.3155 0.906502C10.7847 0.831683 10.7466 0.825191 10.7466 0.825191C10.3409 0.773164 9.99863 0.803923 9.66826 0.833605L9.59517 0.840577C9.16987 0.878883 8.74208 0.955225 8.32128 1.06708L8.32465 1.07242Z"
                        fill="#F3F3F1"
                    />
                    <path
                        d="M3.80423 2.43369L0.499442 2.42908C0.479575 2.42905 0.461865 2.44281 0.456058 2.46226C-0.388879 5.292 -0.203226 6.72851 2.2437 8.75562C2.25394 8.7641 2.26799 8.76776 2.28094 8.7653C5.19421 8.2122 6.04206 7.04252 6.77992 4.15535C6.78514 4.13493 6.77629 4.11297 6.75825 4.10273L3.82607 2.43949C3.81939 2.4357 3.81187 2.4337 3.80423 2.43369Z"
                        fill="#F588B9"
                    />
                    <path
                        d="M4.74044 4.03544L3.12466 3.75292L1.98723 5.51786L2.80624 5.66107L1.96798 7.14167L4.25072 5.32449L3.22418 5.145L4.74044 4.03544Z"
                        fill="#F3F3F1"
                    />
                </svg>
            </div>
        </label>
    );
}
